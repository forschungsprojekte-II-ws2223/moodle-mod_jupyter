{"version":3,"file":"submit_notebook.min.js","sources":["../src/submit_notebook.js"],"sourcesContent":["import { submitNotebook } from \"./repository\";\nimport { exception as displayException } from \"core/notification\";\nimport Templates from \"core/templates\";\n\nconst context = {\n  message: \"\",\n  closebutton: 1,\n  announce: 1,\n  points: []\n};\n\nconst Selectors = {\n  elements: {\n    submitResponseBody: '[data-element=\"mod_jupyter/body-placeholder\"]',\n  },\n  actions: {\n    submitButton: '[data-action=\"mod_jupyter/submit-notebook_button\"]',\n    resetModal: '[data-action=\"mod_jupyter/reset-modal_button\"]',\n  },\n};\n\n\n/**\n * Add event listeners to Selectors.\n * @param {*} param0\n */\nexport const init = async ({ user, courseid, instanceid, filename, token }) => {\n  document.addEventListener(\"click\", (e) => {\n    if (e.target.closest(Selectors.actions.submitButton)) {\n      resetModalTable();\n      callSubmitNotebook(user, courseid, instanceid, filename, token);\n    }\n  });\n\n  document.addEventListener(\"click\", (e) => {\n    if (e.target.closest(Selectors.actions.resetModal)) {\n      resetModalTable();\n    }\n  });\n};\n\n\n/**\n * Call external service from repository to submit notebook to grading service and display graded response.\n *\n * @param {string} user\n * @param {int} courseid\n * @param {int} instanceid\n * @param {string} filename\n * @param {string} token\n */\nconst callSubmitNotebook = async (\n  user,\n  courseid,\n  instanceid,\n  filename,\n  token\n) => {\n  const response = await submitNotebook(\n    user,\n    courseid,\n    instanceid,\n    filename,\n    token\n  );\n  context.points = response;\n  renderModalTable();\n};\n\n/**\n * Render table inside the submit modal to show submit response.\n */\nconst renderModalTable = (\n) => {\n  Templates.renderForPromise(\"mod_jupyter/submit_response_modal_table\", context)\n    // It returns a promise that needs to be resoved.\n    .then(({ html, js }) => {\n      // Here eventually I have my compiled template, and any javascript that it generated.\n      // The templates object has append, prepend and replace functions.\n      Templates.replaceNodeContents(\n        Selectors.elements.submitResponseBody,\n        html,\n        js\n      );\n    })\n    // Deal with this exception (Using core/notify exception function is recommended).\n    .catch((error) => displayException(error));\n};\n\n/**\n * Replace table with loading template for reset.\n */\nconst resetModalTable = async (\n) => {\n  Templates.renderForPromise(\"mod_jupyter/loading\", context)\n    // It returns a promise that needs to be resoved.\n    .then(({ html, js }) => {\n      // Here eventually I have my compiled template, and any javascript that it generated.\n      // The templates object has append, prepend and replace functions.\n      Templates.replaceNodeContents(\n        Selectors.elements.submitResponseBody,\n        html,\n        js\n      );\n    })\n    // Deal with this exception (Using core/notify exception function is recommended).\n    .catch((error) => displayException(error));\n};\n"],"names":["context","message","closebutton","announce","points","Selectors","submitResponseBody","submitButton","resetModal","async","user","courseid","instanceid","filename","token","document","addEventListener","e","target","closest","resetModalTable","callSubmitNotebook","response","renderModalTable","renderForPromise","then","_ref2","html","js","replaceNodeContents","catch","error","_ref3"],"mappings":"uTAIMA,QAAU,CACdC,QAAS,GACTC,YAAa,EACbC,SAAU,EACVC,OAAQ,IAGJC,mBACM,CACRC,mBAAoB,iDAFlBD,kBAIK,CACPE,aAAc,qDACdC,WAAY,gEASIC,MAAAA,WAAOC,KAAEA,KAAFC,SAAQA,SAARC,WAAkBA,WAAlBC,SAA8BA,SAA9BC,MAAwCA,YACjEC,SAASC,iBAAiB,SAAUC,IAC9BA,EAAEC,OAAOC,QAAQd,kBAAkBE,gBACrCa,kBACAC,mBAAmBX,KAAMC,SAAUC,WAAYC,SAAUC,WAI7DC,SAASC,iBAAiB,SAAUC,IAC9BA,EAAEC,OAAOC,QAAQd,kBAAkBG,aACrCY,4BAeAC,mBAAqBZ,MACzBC,KACAC,SACAC,WACAC,SACAC,eAEMQ,eAAiB,8BACrBZ,KACAC,SACAC,WACAC,SACAC,OAEFd,QAAQI,OAASkB,SACjBC,oBAMIA,iBAAmB,wBAEbC,iBAAiB,0CAA2CxB,SAEnEyB,MAAKC,YAACC,KAAEA,KAAFC,GAAQA,6BAGHC,oBACRxB,mBAAmBC,mBACnBqB,KACAC,OAIHE,OAAOC,QAAU,2BAAiBA,UAMjCX,gBAAkBX,6BAEZe,iBAAiB,sBAAuBxB,SAE/CyB,MAAKO,YAACL,KAAEA,KAAFC,GAAQA,6BAGHC,oBACRxB,mBAAmBC,mBACnBqB,KACAC,OAIHE,OAAOC,QAAU,2BAAiBA"}